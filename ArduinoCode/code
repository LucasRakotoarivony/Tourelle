#include <SPI.h>  
#include <Pixy.h>
#include <Servo.h> 

Servo myservo;
Pixy pixy;
uint16_t blocks;
int i=0;int j;
float x1;float y1;float x2;float y2;float x3;float y3;
float a;float b;float c;
float cible=100;
float delta;float r1;float r2;
int pos;int final;

void setup()
{
  Serial.begin(9600);
  Serial.println("DÃ©but");
  pixy.init();
  myservo.attach(8);
  myservo.write(90);
}
void loop() {
 blocks=pixy.getBlocks();
 delay(30);
 if(blocks) {
   i++;
   if(i==3) {
     for(j=0;j<blocks;j++) {
       if(pixy.blocks[j].width>30 && pixy.blocks[j].height>30) {
         x1=pixy.blocks[0].x;y1=pixy.blocks[0].y;
         }
       }
     }
     if(i==5) {
     for(j=0;j<blocks;j++) {
       if(pixy.blocks[j].width>30 && pixy.blocks[j].height>30) {
         x2=pixy.blocks[0].x;y2=pixy.blocks[0].y;
         }
        }
     }
     if(i==7) {
     for(j=0;j<blocks;j++) {
       if(pixy.blocks[j].width>30 && pixy.blocks[j].height>30) {
         x3=pixy.blocks[0].x;y3=pixy.blocks[0].y;
         }
        }
       }
  }
//if(i>15) {i=0;}
//Serial.println(i);
//Serial.print(x1);Serial.print("   ");Serial.print(x2);Serial.print("   ");Serial.println(x3);
//Serial.print(y1);Serial.print("   ");Serial.print(y2);Serial.print("   ");Serial.println(y3);
if(x1!=0 && x2!=0 && x3!=0 && x1<x3) {
  c=y1-a*x1*x1-b*x1;
  b=(y2-a*x2*x2-c)/x2;
  a=(y3-b*x3-c)/(x3*x3);
  delta=b*b-4*a*(c-cible);
  if(delta<=0) {Serial.println("Cible intouchable");}
  else {r1=(-b-sqrt(delta))/(2*a);r2=(-b+sqrt(delta))/(2*a);
    if(x3-x1>0) {Serial.println(r2);pos=(int) (r2/5);
  final=(int) (r2*0.6);}
    else {Serial.println(r1);pos=(int) (r1/5);
  final=(int) (r1*0.6);}
  }
}
  
  
  else if(x1!=0 && x2!=0 && x3!=0 && x1>x3) {
  c=y3-a*x3*x3-b*x3;
  b=(y2-a*x2*x2-c)/x2;
  a=(y1-b*x1-c)/(x1*x1);
  delta=b*b-4*a*(c-cible);
  if(delta<=0) {Serial.println("Cible intouchable");}
  else {r1=(-b-sqrt(delta))/(2*a);r2=(-b+sqrt(delta))/(2*a);
    if(x3-x1>0) {Serial.println(r2);pos=(int) (r2/5);
  final=(int) (r2*0.6);}
    else {Serial.println(r1);pos=(int) (r1/5);
  final=(int) (r1*0.6);}
  }
  }
  
    if(final>=0 && final<=180) {myservo.write(pos);}
  Serial.print("Cible touchable en ");Serial.print(r1);  Serial.print(" ou  ");Serial.println(r2);
  Serial.println(final);
//Serial.println(c);
Serial.print("y=");Serial.print(a);Serial.print("x*x+");Serial.print(b);Serial.print("x+");Serial.println(c);
Serial.println(i);
if(i>=9) {i=0;a=0;b=0;c=0;myservo.write(90);Serial.println("zala");}
}
//1:vert  2:bleu  3:rien  4:jaune  5:rouge  6:violet  7:orange
